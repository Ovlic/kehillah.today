<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <script type="text/javascript" src="https://code.jquery.com/jquery-latest.min.js"></script>
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png" />
    <link rel="manifest" href="favicon/site.webmanifest" />
    <link rel="shortcut icon" type="image/x-icon" href="favicon/favicon.ico" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Righteous&family=Barlow+Semi+Condensed&display=swap" rel="stylesheet" />
    <title>kehillah.today</title>
    <script src="dates.js?v=0"></script>
    <meta name="description" content="" />
</head>

<body style="background-color:#eef" class="unselectable">
    <p class="logo">
        <span style="color: #414256">kehillah</span><span style="color: #9590a5">.</span><span
            style="color: #cc3333">today</span>
    </p>

    <p style="margin: 20px">
        <i><span style="color: #414256"><span id="todayis"><noscript>JavaScript is disabled. This website will not function until you enable it.</noscript></span><span id="howstheschedule"></span></i>
    </p>
    
    <br class="lines">

    <p class="display" style="font-size:40px" id="whatsup"></p>
    <p class="display" style="font-size:150px;" id="clock"></p>
    
    <br class="lines">


    <p class="logo" >
        <span style="color: #414256">kehillah</span><span style="color: #9590a5">.</span><span
            style="color: #cc9933">upcoming</span>
    </p>

    <style>
        .display {
            font-family: 'Bebas Neue';
            margin: 40px;
            text-align: center;
            color: #335;
            line-height: 0.6

        }
        .logo {
            font-family: 'Righteous';
            font-size: 30px;
            margin: 20px;
        }

        a {
            text-decoration: #aac underline;
        }

        p {
            line-height: 0.4
        }

        .lines {
            line-height: 1.5
        }

        body {
            font-family: 'Barlow Semi Condensed';
            font-variant-numeric: tabular-nums;
        }
    </style>
    <script>
        minutes = 0;
        dnow = new Date();
        var dotw = ["SUN", "MON", "TUES", "WED", "THU", "FRI", "SAT"]
        var fulldotw = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Logsday"]
        var fullmoty = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"]
        var trigger = -1;
        var theschedule = ""
        var blockcolors = ["#c6c6d6","#6ec0d6","#8d7cc2","#c17ba0","#e06665","#2aa3ac","#d64087","#b4a7d5","#9fc5e9","#d6a6be",]
        var correctjsondata = ""
        var total = 0
        var pageloaddate = dnow.getDate()

        document.getElementById('todayis').innerText = fulldotw[dnow.getDay()] + ", " + fullmoty[dnow.getMonth()] + " " + dnow.getDate() + " · " 

        function apz(num) { /*add prefix zero*/
          return (num < 10 ? '0' : '') + num;
        };

        function MakeFunTimestamps(convert) {
            if (convert <= 0) {
                convertible = "Passed!";
            } else if (convert <= 1) {
                convertible =
                (((convert) * 60).toFixed(2) + "s");
            } else if (convert <= 60) {
                convertible =
                (Math.floor((convert))) +
                    "m " +
                    (Math.floor((convert * 60)) % 60) +
                    "s"
            } else if (convert > 60) {
                convertible =
                (Math.floor((convert) / 60)) +
                    "h " +
                    (Math.floor((convert)) % 60) +
                    "m";
            }

            return convertible;
        }

        function getColor(id) {
            console.log(id)
            if(id.startsWith("Block")) {
                return blockcolors[id.slice(-1)];
            } else {
                return blockcolors[0];
            }
        }

        function UpdateClock(convert) {
            //console.log(convert)
            if (convert <= 0) {
                convertible = "";
            } else if (convert <= 1) {
                convertible =
                apz(((convert) * 60).toFixed(2));
            } else if (convert <= 60) {
                convertible =
                apz(Math.floor((convert))) +
                    ":" +
                    apz(Math.floor((convert * 60)) % 60)
            } else if (convert > 60) {
                convertible =
                apz(Math.floor((convert) / 60)) +
                    ":" +
                    apz(Math.floor((convert)) % 60) +
                    ":" + apz(Math.floor((convert * 60)) % 60)
            }

            return convertible;
        }

        datedata = window.dates;

        function WhichScheduleToLoad(day = (dnow.getFullYear() + "-" + apz(dnow.getMonth() + 1) + "-" + apz(dnow.getDate())), future=false) {
            console.log(day)
            if (day in datedata) {
                document.getElementById('howstheschedule').innerText = "Abnormal Schedule"
                console.log("Date exists.")
                if(future === false) {
                window.theschedule = day
                }
                return day
            } else {
                console.log("Date does not exist.")
                document.getElementById('howstheschedule').innerText = "Normal Schedule"
                if(future === false) {
                window.theschedule = dotw[dnow.getDay()]
                }
                return dotw[dnow.getDay()]
            }
        }

        function UpdateTimer() {
            trigger = -1;
            var dnow = new Date();
            minutes = ((dnow.getSeconds() / 60) + dnow.getMinutes() + (dnow.getHours() * 60) + (dnow.getMilliseconds() / 60000))
            for (i = 0; i < EventsToLoad; i++) {
                document.getElementById('event_' + String(i)).innerHTML = "<b>" + datedata[theschedule][i]['name'] + "</b> in " + MakeFunTimestamps(datedata[theschedule][i]['timestamp'] - minutes);
                if (datedata[theschedule][i]['timestamp'] - minutes < 0) {
                    document.getElementById('event_' + String(i)).style.display = "none";
                    //console.log("hid element: " + datedata[theschedule][i]['timestamp'] + " was less than " + minutes)
                } else {
                    if(trigger == -1) {
                    console.log('triggered thing - item #' + i + ' was visible!')
                        trigger = i;
                    }
                }
            }
            document.getElementById('clock').innerText = UpdateClock(datedata[theschedule][trigger]['timestamp'] - minutes)
            document.title = (UpdateClock(datedata[theschedule][trigger]['timestamp'] - minutes) + " | kehillah.today")
            if(trigger <= 0) {
            document.getElementById('whatsup').innerHTML = "⸻&emsp; FREE &emsp;⸻"
            } else {
            document.getElementById('whatsup').innerHTML = "⸻&emsp;" + datedata[theschedule][trigger - 1]['name'] + "&emsp;⸻"
            }

            if(!(pageloaddate == dnow.getDate())) {
                location.reload()
            }
        }

        function MakeEverything() {
            correctjsondata = window.datedata[WhichScheduleToLoad()]
            correctjsondata.forEach(function(object) {
                if(object.name) {
                    total = total + 1;
                }
            })

            if (!(datedata[theschedule][total] == undefined)) {
                if("message" in datedata[theschedule][total]) {
            document.getElementById('howstheschedule').innerText = datedata[theschedule][total]['message']
            }
        }

            window.EventsToLoad = total;
            console.log("Loading events: " + window.EventsToLoad);
            for (var i = 0; i < window.EventsToLoad; i += 1) { //Make HTML elements
                var div = document.createElement("div");
                console.log("Made an element.");
                div.id = ("event_" + i);
                div.innerHTML = ("Loading...");
                div.style.padding = "15px";
                div.style.backgroundColor = "#9590a5";
                div.style.boxShadow = "0px 0px 0px 2px #eEF";  
                div.style.textAlign = "left";
                div.style.fontSize = "1.5em"
                div.style.lineHeight = "100%"
                div.style.background = getColor(datedata[theschedule][i]['name'])
                document.body.appendChild(div);
            }
        }

        MakeEverything()

        setInterval(UpdateTimer, 64)
    </script>
    <br class="lines">
    <p class="logo">
        <span style="color: #414256">kehillah</span><span style="color: #9590a5">.</span><span
            style="color: #3399cc">future</span>
    </p>

    <p id="credits" style="color:#aac; margin: 20px;" class="lines">
    <span>Created by B. Gill.</span><br>
    <span>Data sourced from the <a href="https://kehillah.org/wp-content/uploads/2022/08/MasterSchedule22_23.jpg" target="_blank" rel="noopener noreferrer"><span style="color: #aac">Kehillah master schedule</span></a>.</span><br>
    <span><span style="font-family: Righteous">kehillah.today</span> is not affiliated with <a href="https://kehillah.org/" target="_blank" rel="noopener noreferrer"><span style="color: #aac">kehillah.org</span></a>.</span><br>
    <span>Fonts used: <span style="font-family: Righteous">Righteous</span>, <span style="font-family: Bebas Neue">Bebas Neue</span>, and Barlow Semi Condensed.</span><br>
    <span>v0.1 &mdash; 2022-08-18</span><br>
    <span></p>

</body>

</html>